---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const posts = await getCollection('blog');

const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
const recentPosts = sortedPosts.slice(0, 5);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			.latest-posts-section {
				margin-top: 3rem;
			}
			.latest-posts-section h2 {
				font-size: 1.75rem;
				margin-bottom: 1rem;
				border-bottom: 1px solid #ddd;
				padding-bottom: 0.5rem;
			}
			.latest-posts-section ul {
				list-style: none;
				padding: 0;
			}
			.latest-posts-section li {
				margin-bottom: 1.5rem;
			}
			.post-title {
				font-size: 1.2rem;
				font-weight: 600;
				text-decoration: none;
				color: var(--text-color); /* Uses your global color variable */
			}
			.post-title:hover {
				text-decoration: underline;
			}
			.post-date {
				display: block;
				margin-top: 0.25rem;
				color: #888;
				font-size: 0.9rem;
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<h1>Welcome</h1>

			<section class="latest-posts-section">
				<h2>Latest Posts</h2>
				<ul>
					{
						recentPosts.map((post) => (
							<li>
							{/* CORRECT: Use `post.slug` for the link's href */}
							<a class="post-title" href={`/blog/${post.id}/`}>	
          						{post.data.title}
        					</a>	
							<span class="post-date">
								{post.data.pubDate.toLocaleDateString('en-us', {
								year: 'numeric',
								month: 'long',
								day: 'numeric',
								})}
							</span>
							</li>
						))
					}

				</ul>
			</section>
			</main>
		<Footer />
	</body>
</html>